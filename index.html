<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Puppy pillow fortress</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.5/+esm';
    window.supabase = createClient(
      'https://lglcvsptwkqxykapepey.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxnbGN2c3B0d2txeHlrYXBlcGV5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDcwNzQ1NDcsImV4cCI6MjA2MjY1MDU0N30.ci7v2g-5wixuPKnG6wUUO87AsbI1bQ8wzRnHHG9QzIQ'
    );
  </script>
  <style>
    :root {
      --hero-gap: 1.5em;
    }

    html, body {
      margin: 0;
      padding: 0;
      font-family: comic sans, sans-serif;
      background-color: #8a2be2;
      color: white;
      overflow-x: hidden;
    }

    body {
      position: relative;
      min-height: 100vh;
    }

    .container {
      position: relative;
      max-width: 800px;
      margin: calc(var(--hero-gap) + 1em) auto 2.5em;
      padding: calc(1.75em + var(--hero-gap) / 2) 2em 2.5em;
      text-align: center;
      z-index: 1;
      background: rgba(32, 6, 63, 0.9);
      border-radius: 24px;
      box-shadow: 0 20px 60px rgba(16, 2, 37, 0.65);
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
      border: 1px solid rgba(230, 210, 255, 0.45);
    }

    .background-controls {
      display: flex;
      justify-content: flex-end;
      margin: 0 0 1.5em;
    }

    .next-background-button {
      cursor: pointer;
      padding: 0.6em 1.4em;
      background: rgba(255, 255, 255, 0.85);
      color: #5a1a9c;
      font-weight: 700;
      border: 2px solid #f3e5ff;
      border-radius: 999px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      transition: background 0.3s ease, transform 0.3s ease;
    }

    .next-background-button:hover,
    .next-background-button:focus-visible {
      background: #f3e5ff;
      transform: translateY(-2px);
    }

    .next-background-button:focus-visible {
      outline: 3px solid rgba(158, 94, 222, 0.55);
      outline-offset: 2px;
    }

    .hero-layer {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100vw;
      height: 100vh;
      z-index: 0;
      pointer-events: none;
    }

    .hero-layer__slider {
      position: relative;
      width: min(1200px, 96vw);
      height: min(900px, 90vh);
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 16px 60px rgba(70, 20, 130, 0.55);
      background: linear-gradient(135deg, rgba(54, 18, 92, 0.9), rgba(101, 45, 168, 0.7));
    }

    .hero-layer__image {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 20px;
      margin: 0;
      opacity: 0;
      transform: translateX(0);
      transition: transform 0.7s ease, opacity 0.7s ease;
    }

    .hero-layer__image--current {
      opacity: 1;
    }

    .hero-layer__image--incoming {
      transform: translateX(100%);
    }

    .hero-layer__image--slide-in {
      transform: translateX(0);
      opacity: 1;
    }

    .hero-layer__image--slide-out {
      transform: translateX(-100%);
      opacity: 0;
    }

    .textbox {
      background-color: rgba(255,255,255,0.1);
      border: 2px solid white;
      border-radius: 15px;
      padding: 1em;
      margin: 1em 0;
    }

    img {
      max-width: 100%;
      max-height: 60vh;
      height: auto;
      border-radius: 10px;
      margin: 1em 0;
    }

    .bear-cookie-button {
      background: none;
      border: none;
      padding: 0;
      margin: 1.5em auto;
      display: inline-block;
      cursor: pointer;
      position: relative;
      max-width: min(420px, 100%);
    }

    .bear-cookie-button:focus-visible {
      outline: 3px solid #dabfff;
      outline-offset: 4px;
      border-radius: 15px;
    }

    .bear-cookie-button img {
      margin: 0;
      display: block;
      width: 100%;
      border-radius: 18px;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .bear-cookie-button:hover img,
    .bear-cookie-button:focus-visible img {
      transform: translateY(-3px);
      box-shadow: 0 12px 26px rgba(0, 0, 0, 0.35);
    }

    .link-button,
    #bark-test {
      cursor: pointer;
      display: inline-block;
      margin: 0.5em;
      padding: 0.7em 1.4em;
      background-color: white;
      color: #6a0dad;
      font-weight: bold;
      border: 2px solid white;
      border-radius: 25px;
      text-decoration: none;
    }

    .side-button {
      background: white;
      color: #6a0dad;
      min-height: 140px;
      width: 60px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-weight: bold;
      font-size: 0.85em;
      border: 2px solid white;
      text-decoration: none;
      padding: 0.7em 0.5em;
      border-radius: 15px;
    }

    .side-button--right {
      border-radius: 15px 0 0 15px;
    }

    #right-side-buttons {
      position: fixed;
      top: 50%;
      right: 0;
      transform: translateY(-50%);
      display: flex;
      flex-direction: column;
      gap: 1.5em;
      z-index: 1000;
    }

    .side-button--left {
      position: fixed;
      top: 50%;
      left: 0;
      transform: translateY(-50%);
      border-radius: 0 15px 15px 0;
      z-index: 1000;
    }
    #paw-panel {
      position: fixed;
      top: 0;
      left: 0;
      height: 100%;
      width: clamp(300px, 70vw, 500px);
      background-color: #6a5acd;
      padding: 2em;
      box-shadow: 4px 0 15px rgba(0, 0, 0, 0.6);
      z-index: 999;
      overflow-y: auto;
      transition: transform 0.3s ease;
      transform: translateX(-100%);
    }

    #paw-panel.open { transform: translateX(0); }

    #paw-name,
    #paw-input {
      width: 100%;
      border-radius: 10px;
      padding: 0.5em;
      font-size: 1em;
      margin-bottom: 1em;
      border: none;
    }

    #paw-input {
      height: 60px;
      resize: none;
    }

    #paw-submit {
      background-color: #dabfff;
      color: #4b0082;
      font-weight: bold;
      border: none;
      border-radius: 10px;
      padding: 0.5em 1em;
      cursor: pointer;
    }

    #paw-feedback {
      margin-top: 0.5em;
      font-style: italic;
    }

    #cookie-popup {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: white;
      color: #6a0dad;
      border: 2px solid #dabfff;
      border-radius: 15px;
      padding: 1.4em 2.5em 1.2em;
      z-index: 9999;
      text-align: center;
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.25);
      width: min(92vw, 360px);
      box-sizing: border-box;
      outline: none;
    }

    #cookie-popup:focus-visible {
      outline: 3px solid #dabfff;
      outline-offset: 6px;
    }

    #cookie-popup.hidden {
      display: none !important;
    }

    #cookie-popup p {
      margin: 0;
    }

    #cookie-popup button {
      margin: 0.8em 0.6em 0 0.6em;
      padding: 0.5em 1.2em;
      font-weight: bold;
      background-color: #dabfff;
      color: #4b0082;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: transform 0.15s ease, box-shadow 0.15s ease;
    }

    #cookie-popup button:hover,
    #cookie-popup button:focus-visible {
      transform: translateY(-1px);
      box-shadow: 0 6px 15px rgba(106, 13, 173, 0.25);
    }

    .cookie-popup__actions {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 0.5em;
      margin-top: 1em;
    }

    .cookie-info-button {
      position: absolute;
      top: -12px;
      right: -12px;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 2px solid #4b0082;
      background: #dabfff;
      color: #4b0082;
      font-weight: 900;
      font-size: 1.2em;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 8px 18px rgba(0, 0, 0, 0.2);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .cookie-info-button:hover,
    .cookie-info-button:focus-visible {
      transform: translateY(-2px) rotate(-6deg);
      box-shadow: 0 12px 22px rgba(106, 13, 173, 0.35);
    }

    @media (max-width: 480px) {
      #cookie-popup {
        padding: 1.1em 1.4em 1em;
      }

      #cookie-popup button {
        width: 100%;
        margin: 0.6em 0 0 0;
      }

      .cookie-popup__actions {
        flex-direction: column;
        align-items: stretch;
      }

      .cookie-info-button {
        top: -10px;
        right: -10px;
      }
    }

    #cookie-info-modal {
      position: fixed;
      inset: 0;
      background: rgba(20, 0, 40, 0.7);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      padding: 1.5em;
    }

    #cookie-info-modal.open {
      display: flex;
    }

    .cookie-info-card {
      background: white;
      color: #4b0082;
      border-radius: 18px;
      border: 2px solid #dabfff;
      padding: 1.5em;
      max-width: min(480px, 90vw);
      box-shadow: 0 20px 45px rgba(0, 0, 0, 0.35);
      text-align: left;
    }

    .cookie-info-card h2 {
      margin-top: 0;
      text-align: center;
    }

    .cookie-info-card p {
      margin: 0.75em 0;
      line-height: 1.4;
    }

    .cookie-info-card ul {
      padding-left: 1.2em;
      margin: 0.75em 0 1em;
    }

    .cookie-info-card li {
      margin-bottom: 0.5em;
    }

    .cookie-info-close {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border: none;
      background: #dabfff;
      color: #4b0082;
      font-weight: bold;
      border-radius: 999px;
      padding: 0.5em 1.5em;
      cursor: pointer;
      margin: 0 auto;
      display: block;
      transition: transform 0.15s ease, box-shadow 0.15s ease;
    }

    .cookie-info-close:hover,
    .cookie-info-close:focus-visible {
      transform: translateY(-1px);
      box-shadow: 0 8px 20px rgba(106, 13, 173, 0.35);
    }

    #volume-wrapper { margin-top: 1em; }
    #volume-icon { font-size: 1.5em; margin-top: 0.5em; }
    #volume-control {
      width: 80%;
      margin-top: 0.3em;
      accent-color: #dabfff;
    }
    #volume-label { font-size: 1em; margin-top: 0.5em; display: block; }

    .vertical-text {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      letter-spacing: 0.15em;
      white-space: nowrap;
      transform-origin: center;
    }

    .vertical-text__inner {
      display: inline-block;
      letter-spacing: 0.15em;
      white-space: nowrap;
    }

    .vertical-text--bottom-to-top {
      transform: rotate(-90deg);
    }

    .vertical-text--top-to-bottom {
      transform: rotate(90deg);
    }

    body.blur .container,
    body.blur #paw-panel,
    body.blur .side-button,
    body.blur .hero-layer__image {
      filter: blur(5px);
      pointer-events: none;
      user-select: none;
    }

    @media (max-width: 600px) {
      :root {
        --hero-gap: 1em;
      }

      .container {
        margin: calc(var(--hero-gap) + 1em) 1em 2em;
        padding: calc(1.4em + var(--hero-gap) / 2) 1.5em 2em;
      }

      .hero-layer__slider {
        width: min(520px, 92vw);
        height: min(70vh, 520px);
      }
    }
  </style>
</head>
<body>
  <div class="hero-layer" aria-hidden="true">
    <div class="hero-layer__slider"></div>
  </div>
  <!-- Cookie Popup -->
  <div
    id="cookie-popup"
    role="dialog"
    aria-live="polite"
    aria-modal="true"
    aria-labelledby="cookie-popup-title"
    tabindex="-1"
  >
    <button
      type="button"
      id="cookie-info-button"
      class="cookie-info-button"
      title="What cookies do we use? üç™ Click for the full list!"
      aria-label="Open the list of cookies we use"
      aria-haspopup="dialog"
      aria-controls="cookie-info-modal"
    >
      ?
    </button>
    <p id="cookie-popup-title"><strong>I like cookies :3 (we use one to remember your choice!)</strong></p>
    <div class="cookie-popup__actions">
      <button id="cookie-no">no (leave page)</button>
      <button id="cookie-yes">yes I do</button>
    </div>
  </div>

  <div
    id="cookie-info-modal"
    role="dialog"
    aria-modal="true"
    aria-labelledby="cookie-info-title"
    aria-hidden="true"
  >
    <div class="cookie-info-card">
      <h2 id="cookie-info-title">Our cookie jar üç™</h2>
      <p>Here&apos;s the teeny list Firefox spotted:</p>
      <ul>
        <li><strong>cookieConsent</strong> &ndash; our only first-party cookie. It remembers that you said yes so the blur and banner stay gone for a year.</li>
        <li><strong>sp_t</strong> &ndash; set by the Spotify playlist iframe so the embed can keep your Spotify session happy.</li>
        <li><strong>sp_landing</strong> &ndash; another Spotify helper that recalls which Spotify page the iframe last loaded.</li>
        <li><strong>__cf_bm</strong> &ndash; Cloudflare&apos;s bot-fairy from Supabase, making sure the paw-print data is requested by a real pupper-lover.</li>
      </ul>
      <p>Firefox usually counts three right away because our <code>cookieConsent</code> cookie only appears after you press ‚Äúyes‚Äù.</p>
      <button type="button" class="cookie-info-close" id="cookie-info-close">Close cookie peek</button>
    </div>
  </div>

  <!-- Side Buttons -->
  <div id="right-side-buttons">
    <a id="blog-link" class="side-button side-button--right" href="blog.html">
      <span class="vertical-text vertical-text--bottom-to-top">
        <span class="vertical-text__inner">üìì Blog</span>
      </span>
    </a>
    <a id="story-link" class="side-button side-button--right" href="story.html">
      <span class="vertical-text vertical-text--bottom-to-top">
        <span class="vertical-text__inner">üìñ Story</span>
      </span>
    </a>
  </div>
  <div id="paw-open" class="side-button side-button--left">
    <span class="vertical-text vertical-text--top-to-bottom">
      <span class="vertical-text__inner">üêæ Pawprints</span>
    </span>
  </div>
  <!-- Paw Print Panel -->
  <div id="paw-panel">
    <button id="paw-close">‚ùå Close</button>
    <h2>üêæ Leave a Paw Print</h2>
    <input id="paw-name" maxlength="50" placeholder="Your name (required)" />
    <textarea id="paw-input" maxlength="100" placeholder="Say something cute (max 100 chars)"></textarea>
    <button id="paw-submit">Submit</button>
    <div id="paw-feedback"></div>
    <h3>Recent Paw Prints</h3>
    <div id="paw-prints"></div>
  </div>

  <!-- Bark Sound -->
  <audio id="bark-sound" preload="auto">
    <source src="Lucy.aac" type="audio/aac">
  </audio>

  <!-- Main Content -->
  <div class="container">
    <div class="background-controls">
      <button id="next-background" class="next-background-button" type="button">Next background</button>
    </div>
    <h1>Puppy pillow fortress</h1>

    <div class="textbox">
      <h2>About Me</h2>
      <p>Hello! We are the Puppy Pillow Fortress System Pumpkin (She/it/pup),Nyx (She/her),Nele (She/her),Catt (She/her) .<br>
        We hail from the ancient past of the 22nd day from the Second Month in the year 1998 | I do a lot of lewd things, so minors do not Interact |
        I am a committed anti-fascist and Communist | I'm trans and on Estrogen since 04.02.2025üè≥Ô∏è‚Äç‚ößÔ∏è |
        I am considering myself as Sapphic/bi though I definitely prefer Women | I am poly and happily married |
        üíú Purple is my favourite colour | üöÄ Rockets are pretty cool I guess |
        üîåüöó Electric car enthusiast, currently have a Tesla Model Y (fuck Elon) and a 95‚Äô Mazda Miata |
        üöÇ Train enthusiast | fuck elon musk | be yourself especially if it's weird
      </p>
    </div>

    <div class="textbox">
      <h2>Links</h2>
      <a class="link-button" href="https://discord.gg/Jhj2znHaEB" target="_blank">Discord Server</a>
      <a class="link-button" href="https://bsky.app/profile/nele.pet" target="_blank">Bluesky</a>
      <a class="link-button" href="https://www.tumblr.com/nele-likes-stuff" target="_blank">Tumblr</a>
      <a class="link-button" href="https://www.reddit.com/user/CapFuture_/" target="_blank">Reddit</a>
      <a class="link-button" href="https://steamcommunity.com/id/RCKT_GRL/" target="_blank">Steam</a>
    </div>

    <div class="textbox">
      <h2>Playlist Vibes</h2>
      <iframe style="border-radius:12px"
        src="https://open.spotify.com/embed/playlist/2wjQcW9o0hHiWqchz5XuzF?utm_source=generator&theme=0"
        width="100%" height="352" frameBorder="0" allowfullscreen=""
        allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
        loading="lazy">
      </iframe>
    </div>

    <div class="textbox">
      <h2>üîä Bark Test </br> (credit to <a href="https://lucy.moe">Lucy</a> for the cute sound)</h2>
      <button id="bark-test">Test Bark</button>
      <div id="volume-wrapper">
        <div id="volume-icon">üîä</div>
        <input type="range" id="volume-control" min="0" max="100" step="1">
        <div id="volume-label">Volume: Bark</div>
      </div>
    </div>

    <button
      type="button"
      id="cookie-bear-button"
      class="bear-cookie-button"
      title="Removes: cookieConsent (our remember-me cookie). Spotify & Cloudflare cookies stay snuggled on their own sites."
      aria-label="Ask the bear to remove the cookies we can"
    >
      <img src="https://placebear.com/600/300" alt="A cute bear ready to tidy up cookies" />
    </button>
  </div>

  <!-- JavaScript -->
  <script>
  // Trigger bark on all button or link-button presses
  function triggerBarkOnInteraction(e) {
    const bark = document.getElementById('bark-sound');
    if (!bark) return;

    const target = e.target.closest('button, .link-button, span');
    if (target) {
      bark.currentTime = 0;
      bark.play();
    }
  }

  // Mouse click
  document.addEventListener('click', triggerBarkOnInteraction);

  // Touch input (for mobile)
  document.addEventListener('touchstart', triggerBarkOnInteraction);
</script>
  <script>
    const bark = document.getElementById('bark-sound');
    const barkTest = document.getElementById('bark-test');
    const cookiePopup = document.getElementById('cookie-popup');
    const cookieYes = document.getElementById('cookie-yes');
    const cookieNo = document.getElementById('cookie-no');
    const cookieInfoButton = document.getElementById('cookie-info-button');
    const cookieInfoModal = document.getElementById('cookie-info-modal');
    const cookieInfoClose = document.getElementById('cookie-info-close');
    const cookieBearButton = document.getElementById('cookie-bear-button');
    const volumeControl = document.getElementById('volume-control');
    const volumeLabel = document.getElementById('volume-label');
    const volumeIcon = document.getElementById('volume-icon');
    const heroSlider = document.querySelector('.hero-layer__slider');
    const nextBackgroundButton = document.getElementById('next-background');

    const heroImages = [
      { src: 'Untitled_Artwork.jpeg', alt: 'Pastel illustration of Pumpkin and Nyx snuggling amongst pillows.' },
      { src: 'Pumpkin and Nyx.jpg', alt: 'Pumpkin and Nyx cuddling together on a cozy sofa.' },
    ];

    const reduceMotionQuery = window.matchMedia ? window.matchMedia('(prefers-reduced-motion: reduce)') : null;
    let prefersReducedMotion = reduceMotionQuery?.matches ?? false;
    if (reduceMotionQuery) {
      const updateMotionPreference = (event) => {
        prefersReducedMotion = event.matches;
      };

      if (typeof reduceMotionQuery.addEventListener === 'function') {
        reduceMotionQuery.addEventListener('change', updateMotionPreference);
      } else if (typeof reduceMotionQuery.addListener === 'function') {
        reduceMotionQuery.addListener(updateMotionPreference);
      }
    }
    let currentHeroIndex = heroImages.length ? Math.floor(Math.random() * heroImages.length) : 0;
    let activeHeroImage = null;
    let isHeroAnimating = false;

    const createHeroImageElement = (image, additionalClass = '') => {
      const img = document.createElement('img');
      img.className = `hero-layer__image ${additionalClass}`.trim();
      img.src = image.src;
      img.alt = image.alt;
      return img;
    };

    const showHeroImage = (index, { animate = true } = {}) => {
      if (!heroSlider || heroImages.length === 0) {
        nextBackgroundButton?.setAttribute('disabled', 'true');
        return;
      }

      const nextIndex = (index + heroImages.length) % heroImages.length;
      const shouldAnimate = animate && !prefersReducedMotion && !!activeHeroImage;

      if (isHeroAnimating && shouldAnimate) {
        return;
      }

      const imageData = heroImages[nextIndex];
      const newImage = createHeroImageElement(
        imageData,
        shouldAnimate ? 'hero-layer__image--incoming' : 'hero-layer__image--current',
      );

      if (!shouldAnimate) {
        heroSlider.appendChild(newImage);
        if (activeHeroImage && activeHeroImage.parentElement === heroSlider) {
          heroSlider.removeChild(activeHeroImage);
        }
        activeHeroImage = newImage;
        currentHeroIndex = nextIndex;
        nextBackgroundButton?.removeAttribute('disabled');
        return;
      }

      isHeroAnimating = true;
      heroSlider.appendChild(newImage);

      const startTransition = () => {
        requestAnimationFrame(() => {
          newImage.classList.add('hero-layer__image--slide-in');
          activeHeroImage?.classList.add('hero-layer__image--slide-out');
        });
      };

      if (typeof newImage.decode === 'function') {
        newImage
          .decode()
          .catch(() => {})
          .finally(startTransition);
      } else if (!newImage.complete) {
        newImage.addEventListener('load', startTransition, { once: true });
        newImage.addEventListener('error', startTransition, { once: true });
      } else {
        startTransition();
      }

      const handleTransitionEnd = (event) => {
        if (event.propertyName !== 'transform') return;

        newImage.removeEventListener('transitionend', handleTransitionEnd);
        newImage.classList.remove('hero-layer__image--incoming', 'hero-layer__image--slide-in');
        newImage.classList.add('hero-layer__image--current');

        if (activeHeroImage && activeHeroImage.parentElement === heroSlider) {
          heroSlider.removeChild(activeHeroImage);
        }

        activeHeroImage = newImage;
        currentHeroIndex = nextIndex;
        isHeroAnimating = false;
      };

      newImage.addEventListener('transitionend', handleTransitionEnd);
    };

    const initialiseHeroSlider = () => {
      if (!heroSlider || heroImages.length === 0) {
        nextBackgroundButton?.setAttribute('disabled', 'true');
        return;
      }

      showHeroImage(currentHeroIndex, { animate: false });

      nextBackgroundButton?.addEventListener('click', () => {
        const nextIndex = (currentHeroIndex + 1) % heroImages.length;
        showHeroImage(nextIndex, { animate: true });
      });
    };

    initialiseHeroSlider();

    const COOKIE_NAME = 'cookieConsent';
    const COOKIE_ACCEPTED_VALUE = 'accepted';
    const COOKIE_NAMES_TO_CLEAR = ['cookieConsent', 'sp_t', 'sp_landing', '__cf_bm'];

    const getCookie = (name) => {
      return document.cookie
        .split('; ')
        .find(row => row.startsWith(`${name}=`))
        ?.split('=')[1];
    };

    const setCookie = (name, value, days) => {
      const date = new Date();
      date.setTime(date.getTime() + days * 24 * 60 * 60 * 1000);
      document.cookie = `${name}=${value}; expires=${date.toUTCString()}; path=/; SameSite=Lax`;
    };

    const deleteCookie = (name) => {
      document.cookie = `${name}=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/; SameSite=Lax`;
    };

    const hideCookiePopup = () => {
      cookiePopup?.classList.add('hidden');
      cookiePopup?.setAttribute('aria-hidden', 'true');
    };

    const showCookiePopup = () => {
      cookiePopup?.classList.remove('hidden');
      cookiePopup?.setAttribute('aria-hidden', 'false');
    };

    let lastFocusedElement = null;

    const openCookieInfo = () => {
      if (!cookieInfoModal) return;
      lastFocusedElement = document.activeElement;
      cookieInfoModal.classList.add('open');
      cookieInfoModal.setAttribute('aria-hidden', 'false');
      cookieInfoClose?.focus();
    };

    const closeCookieInfo = () => {
      if (!cookieInfoModal) return;
      cookieInfoModal.classList.remove('open');
      cookieInfoModal.setAttribute('aria-hidden', 'true');
      if (lastFocusedElement && typeof lastFocusedElement.focus === 'function') {
        lastFocusedElement.focus();
      } else {
        cookieInfoButton?.focus();
      }
      lastFocusedElement = null;
    };

    const hasCookieConsent = getCookie(COOKIE_NAME) === COOKIE_ACCEPTED_VALUE;

    if (hasCookieConsent) {
      document.body.classList.remove('blur');
      hideCookiePopup();
    } else {
      document.body.classList.add('blur');
      showCookiePopup();
    }

    cookieYes?.addEventListener('click', () => {
      setCookie(COOKIE_NAME, COOKIE_ACCEPTED_VALUE, 365);
      document.body.classList.remove('blur');
      hideCookiePopup();
    });

    cookieNo?.addEventListener('click', () => {
      window.location.href = 'https://www.google.com/search?q=cookies';
    });

    cookieInfoButton?.addEventListener('click', () => {
      openCookieInfo();
    });

    cookieInfoClose?.addEventListener('click', () => {
      closeCookieInfo();
    });

    cookieInfoModal?.addEventListener('click', (event) => {
      if (event.target === cookieInfoModal) {
        closeCookieInfo();
      }
    });

    document.addEventListener('keydown', (event) => {
      if (event.key === 'Escape' && cookieInfoModal?.classList.contains('open')) {
        closeCookieInfo();
      }
    });

    cookieBearButton?.addEventListener('click', () => {
      COOKIE_NAMES_TO_CLEAR.forEach(deleteCookie);
      document.body.classList.add('blur');
      showCookiePopup();
      cookiePopup?.focus({ preventScroll: true });
    });

    barkTest?.addEventListener('click', () => {
      bark.currentTime = 0;
      bark.play();
    });

    volumeControl?.addEventListener('input', () => {
      const vol = volumeControl.value;
      bark.volume = vol / 100;
      localStorage.setItem('barkVolume', vol);
      volumeLabel.textContent = vol <= 33 ? 'Volume: Arf' : vol <= 66 ? 'Volume: Woof' : 'Volume: Bark';
      volumeIcon.textContent = vol <= 33 ? 'üîà' : vol <= 66 ? 'üîâ' : 'üîä';
    });

    const savedVol = localStorage.getItem('barkVolume') || 100;
    if (bark && volumeControl) {
      bark.volume = savedVol / 100;
      volumeControl.value = savedVol;
      volumeLabel.textContent = savedVol <= 33 ? 'Volume: Arf' : savedVol <= 66 ? 'Volume: Woof' : 'Volume: Bark';
      volumeIcon.textContent = savedVol <= 33 ? 'üîà' : savedVol <= 66 ? 'üîâ' : 'üîä';
    }
  </script>

<script type="module">
  const supabase = window.supabase;
  const pawName = document.getElementById('paw-name');
  const pawInput = document.getElementById('paw-input');
  const pawSubmit = document.getElementById('paw-submit');
  const pawFeedback = document.getElementById('paw-feedback');
  const pawPrints = document.getElementById('paw-prints');
  const pawOpen = document.getElementById('paw-open');
  const pawClose = document.getElementById('paw-close');
  const pawPanel = document.getElementById('paw-panel');

  function escapeHTML(str) {
    return str.replace(/[&<>"']/g, tag => ({
      '&': '&amp;',
      '<': '&lt;',
      '>': '&gt;',
      '"': '&quot;',
      "'": '&#39;',
    }[tag]));
  }

  function normalisePawPrint(pawPrint) {
    const rawMessage = pawPrint.message || '';
    if (pawPrint.name && pawPrint.name.trim()) {
      return {
        name: pawPrint.name.trim(),
        message: rawMessage.trim(),
      };
    }

    const colonIndex = rawMessage.indexOf(':');
    if (colonIndex > -1) {
      const possibleName = rawMessage.slice(0, colonIndex).trim();
      const possibleMessage = rawMessage.slice(colonIndex + 1).trim();
      if (possibleName && possibleMessage) {
        return { name: possibleName, message: possibleMessage };
      }
    }

    return { name: 'Anonymous', message: rawMessage.trim() };
  }

  async function getUserIP() {
    return null;
  }

  async function fetchPawPrints() {
    pawPrints.innerHTML = '<p>Fetching pawprints...</p>';

    const { data, error } = await supabase
      .from('pawprints')
      .select('*')
      .order('created_at', { ascending: false })
      .limit(10);

    if (error) {
      console.error('Error fetching pawprints:', error);
      pawPrints.innerHTML = '<p>Could not load paw prints.</p>';
      return;
    }

    if (!data || data.length === 0) {
      pawPrints.innerHTML = '<p>No paw prints yet.</p>';
      return;
    }

    pawPrints.innerHTML = '';
    data.forEach(p => {
      const { name, message } = normalisePawPrint(p);
      const box = document.createElement('div');
      box.className = 'textbox';
      box.innerHTML = `<p><strong>${escapeHTML(name)}</strong>: ${escapeHTML(message)}</p>`;
      pawPrints.appendChild(box);
    });
  }

  pawOpen?.addEventListener('click', () => {
    pawPanel.classList.add('open');
    pawOpen.style.display = 'none';
    fetchPawPrints();
  });

  pawClose?.addEventListener('click', () => {
    pawPanel.classList.remove('open');
    pawOpen.style.display = 'flex';
  });

  pawSubmit?.addEventListener('click', async () => {
    const name = pawName.value.trim().slice(0, 50);
    const message = pawInput.value.trim().slice(0, 100);

    if (!name) {
      pawFeedback.textContent = 'Please add your name!';
      return;
    }

    if (!message) {
      pawFeedback.textContent = 'Your paw print is empty!';
      return;
    }

    const ip = await getUserIP();
    const combinedMessage = `${name}: ${message}`;

    const { error } = await supabase.from('pawprints').insert({ message: combinedMessage, ip });

    if (error) {
      pawFeedback.textContent = 'Something went wrong.';
      console.error(error);
    } else {
      pawFeedback.textContent = 'Paw print submitted!';
      pawInput.value = '';
      pawName.value = '';
      setTimeout(fetchPawPrints, 2000);
    }
  });
</script>
  <script>
  window.addEventListener('DOMContentLoaded', () => {
    const hasConsent = document.cookie
      .split('; ')
      .find(row => row.startsWith('cookieConsent=')) === 'cookieConsent=accepted';

    if (!hasConsent) {
      document.body.classList.add('blur');
    }
  });
</script>
</body>
</html>
