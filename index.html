<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Puppy pillow fortress</title>

  <!-- Supabase module import -->
  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.5/+esm';
    window.supabase = createClient(
      'https://lglcvsptwkqxykapepey.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxnbGN2c3B0d2txeHlrYXBlcGV5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDcwNzQ1NDcsImV4cCI6MjA2MjY1MDU0N30.ci7v2g-5wixuPKnG6wUUO87AsbI1bQ8wzRnHHG9QzIQ'
    );
  </script>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      font-family: comic sans, sans-serif;
      background-color: #6a0dad;
      color: white;
      overflow-x: hidden;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 2em;
      text-align: center;
    }
    .textbox {
      background-color: rgba(255,255,255,0.1);
      border: 2px solid white;
      border-radius: 15px;
      padding: 1em;
      margin: 1em 0;
    }
    button {
      font-weight: bold;
      border-radius: 10px;
      padding: 0.5em 1em;
      cursor: pointer;
    }
    #blog-panel, #paw-panel {
      position: fixed;
      top: 0;
      height: 100%;
      width: clamp(300px, 70vw, 500px);
      background-color: #4b0082;
      padding: 2em;
      box-shadow: 0 0 15px black;
      z-index: 999;
      overflow-y: auto;
      transition: transform 0.3s ease;
    }
    #blog-panel {
      right: 0;
      transform: translateX(100%);
    }
    #blog-panel.open {
      transform: translateX(0);
    }
    #paw-panel {
      left: 0;
      transform: translateX(-100%);
    }
    #paw-panel.open {
      transform: translateX(0);
    }
    #blog-open, #paw-open {
      position: fixed;
      top: 50%;
      transform: translateY(-50%);
      background: white;
      color: #6a0dad;
      height: 80px;
      width: 30px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-weight: bold;
      z-index: 1000;
    }
    #blog-open {
      right: 0;
      border-radius: 15px 0 0 15px;
    }
    #paw-open {
      left: 0;
      border-radius: 0 15px 15px 0;
    }
    .vertical-text {
      writing-mode: vertical-rl;
      text-orientation: mixed;
      transform: rotate(180deg);
    }
    #paw-input {
      width: 100%;
      height: 60px;
      border-radius: 10px;
      padding: 0.5em;
      font-size: 1em;
      margin-bottom: 1em;
      resize: none;
    }
    #paw-feedback {
      margin-top: 0.5em;
      font-style: italic;
    }
  </style>
</head>
<body>
  <!-- Paw Print Sidebar -->
  <div id="paw-open"><span class="vertical-text">üêæ Paw</span></div>
  <div id="paw-panel">
    <button id="paw-close">‚ùå Close</button>
    <h2>üêæ Leave a Paw Print</h2>
    <textarea id="paw-input" maxlength="100" placeholder="Say something cute (max 100 chars)"></textarea>
    <button id="paw-submit">Submit</button>
    <div id="paw-feedback"></div>
    <h3>Recent Paw Prints</h3>
    <div id="paw-prints"></div>
  </div>

  <!-- Blog Sidebar -->
  <div id="blog-open"><span class="vertical-text">üìì Blog</span></div>
  <div id="blog-panel">
    <button id="blog-close">‚ùå Close</button>
    <h2>üìì Blog Posts</h2>
    <div id="blog-posts"></div>
  </div>

  <!-- Main Content -->
  <div class="container">
    <h1>Puppy pillow fortress</h1>
    <img src="IMG_96721.webp" alt="Kiki snoot" />
    <div class="textbox">
      <p>Hello! I am Nele the succubus puppy girl. Minors DNI. Trans, anti-fascist, poly. Purple-loving rocket pup. Let's bark at trains together!</p>
    </div>
  </div>

  <!-- JS -->
  <script>
    // Blog Panel
    const blogOpen = document.getElementById('blog-open');
    const blogClose = document.getElementById('blog-close');
    const blogPanel = document.getElementById('blog-panel');

    blogOpen.addEventListener('click', () => {
      blogPanel.classList.add('open');
      blogOpen.style.display = 'none';
    });

    blogClose.addEventListener('click', () => {
      blogPanel.classList.remove('open');
      blogOpen.style.display = 'flex';
    });

    fetch('blog.json')
      .then(r => r.json())
      .then(posts => {
        const blogPosts = document.getElementById('blog-posts');
        posts.forEach(post => {
          const box = document.createElement('div');
          box.className = 'textbox';
          box.innerHTML = `<p><strong>${post.date}:</strong> ${post.content}</p>`;
          blogPosts.appendChild(box);
        });
      });
  </script>

  <script type="module">
    const supabase = window.supabase;

    const pawOpen = document.getElementById('paw-open');
    const pawClose = document.getElementById('paw-close');
    const pawPanel = document.getElementById('paw-panel');
    const pawInput = document.getElementById('paw-input');
    const pawSubmit = document.getElementById('paw-submit');
    const pawFeedback = document.getElementById('paw-feedback');
    const pawPrints = document.getElementById('paw-prints');

    pawOpen.addEventListener('click', () => {
      pawPanel.classList.add('open');
      pawOpen.style.display = 'none';
      fetchPawPrints();
    });

    pawClose.addEventListener('click', () => {
      pawPanel.classList.remove('open');
      pawOpen.style.display = 'flex';
    });

    pawSubmit.addEventListener('click', async () => {
      const message = pawInput.value.trim().slice(0, 100);
      if (!message) {
        pawFeedback.textContent = 'Your paw print is empty!';
        return;
      }

      const { error } = await supabase.from('pawprints').insert({ message });
      if (error) {
        pawFeedback.textContent = 'Something went wrong.';
      } else {
        pawFeedback.textContent = 'Paw print submitted!';
        pawInput.value = '';
        fetchPawPrints();
      }
    });

    async function fetchPawPrints() {
      const { data, error } = await supabase
        .from('pawprints')
        .select('*')
        .order('created_at', { ascending: false })
        .limit(10);

      if (error) {
        pawPrints.innerHTML = '<p>Error loading paw prints.</p>';
        return;
      }

      pawPrints.innerHTML = '';
      data.forEach(p => {
        const box = document.createElement('div');
        box.className = 'textbox';
        box.innerHTML = `<p>${escapeHTML(p.message)}</p>`;
        pawPrints.appendChild(box);
      });
    }

    function escapeHTML(str) {
      return str.replace(/[&<>"']/g, tag => ({
        '&': '&amp;',
        '<': '&lt;',
        '>': '&gt;',
        '"': '&quot;',
        "'": '&#39;',
      }[tag]));
    }
    // Ensure only one panel is open at a time
function closeBlog() {
  blogPanel.classList.remove('open');
  blogOpen.style.display = 'flex';
}
function closePaw() {
  pawPanel.classList.remove('open');
  pawOpen.style.display = 'flex';
}

blogOpen.addEventListener('click', () => {
  closePaw();
  blogPanel.classList.add('open');
  blogOpen.style.display = 'none';
});

pawOpen.addEventListener('click', () => {
  closeBlog();
  pawPanel.classList.add('open');
  pawOpen.style.display = 'none';
});
  </script>
</body>
</html>